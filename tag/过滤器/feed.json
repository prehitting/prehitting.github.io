{
    "version": "https://jsonfeed.org/version/1",
    "title": "不利索の鸣 • All posts by \"过滤器\" tag",
    "description": "欢迎来到鸣崽的空间，这里不仅有学习，还有生活",
    "home_page_url": "https://prehitting.gitee.io",
    "items": [
        {
            "id": "https://prehitting.gitee.io/2022/05/30/%E9%A1%B9%E7%9B%AE/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96/day02-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E8%BF%87%E6%BB%A4%E5%99%A8%E9%85%8D%E7%BD%AE/",
            "url": "https://prehitting.gitee.io/2022/05/30/%E9%A1%B9%E7%9B%AE/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96/day02-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E8%BF%87%E6%BB%A4%E5%99%A8%E9%85%8D%E7%BD%AE/",
            "title": "day02-用户登录过滤器配置",
            "date_published": "2022-05-30T00:13:20.000Z",
            "content_html": "<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 用户登录过滤器</span></span><br><span class=\"line\"><span class=\"comment\"> * 检查用户是否已经完成登录</span></span><br><span class=\"line\"><span class=\"comment\"> * 未登录则拒绝访问部分页面</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@WebFilter(filterName = &quot;loginCheckFilter&quot;,urlPatterns = &quot;/*&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LoginCheckFilter</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Filter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">AntPathMatcher</span> <span class=\"variable\">PATH_MATCHER</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AntPathMatcher</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doFilter</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class=\"keyword\">throws</span> IOException, ServletException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> (HttpServletRequest) servletRequest;</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> (HttpServletResponse) servletResponse;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//1. 获取本次请求的URI</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">requestURI</span> <span class=\"operator\">=</span> request.getRequestURI();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;拦截到请求：&quot;</span>+requestURI);</span><br><span class=\"line\">        <span class=\"comment\">//需要放行的资源</span></span><br><span class=\"line\">        String[] urls = <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[] &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;/employee/login&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;/employee/logout&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;/backend/**&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;/front/**&quot;</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">//2. 判断本次请求是否需要放行</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (check(urls,requestURI)) &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;请求&quot;</span>+requestURI+<span class=\"string\">&quot;被放行&quot;</span>);</span><br><span class=\"line\">            filterChain.doFilter(request,response);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//3. 判断登录状态，若已登录则放行</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (request.getSession().getAttribute(<span class=\"string\">&quot;employee&quot;</span>)!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>,request.getSession().getAttribute(<span class=\"string\">&quot;employee&quot;</span>));</span><br><span class=\"line\">            filterChain.doFilter(request,response);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;用户未登录&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//4. 若未登录则返回登录结果，通过输出流方式向客户端页面响应数据</span></span><br><span class=\"line\">        response.getWriter().write(JSON.toJSONString(R.error(<span class=\"string\">&quot;NOTLOGIN&quot;</span>)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 路径匹配，本次请求是否需要放行</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> urls</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> requestURI</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">check</span><span class=\"params\">(String[] urls,String requestURI)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (String url : urls )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (PATH_MATCHER.match(url, requestURI)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>需要在 SpringBoot 启动类上增加 @ServletComponentScan 注解</strong></p>\n",
            "tags": [
                "过滤器",
                "瑞吉外卖"
            ]
        }
    ]
}